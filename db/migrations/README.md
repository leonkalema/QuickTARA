# Database Migrations with Alembic

This directory contains database migration scripts for QuickTARA managed by Alembic.

## Migration Commands

### Create a New Migration

To create a new migration automatically detecting changes:

```bash
alembic revision --autogenerate -m "Description of changes"
```

To create a blank migration:

```bash
alembic revision -m "Description of changes"
```

### Apply Migrations

To apply all pending migrations:

```bash
alembic upgrade head
```

To apply migrations up to a specific revision:

```bash
alembic upgrade <revision_id>
```

### Downgrade Migrations

To downgrade to a previous revision:

```bash
alembic downgrade <revision_id>
```

To downgrade one revision:

```bash
alembic downgrade -1
```

### View Migration History

To view the migration history:

```bash
alembic history
```

### View Current Revision

To view the current revision:

```bash
alembic current
```

## Migration Tips

1. Always review autogenerated migrations before applying them
2. Test migrations in a development environment before applying to production
3. Consider data migrations in addition to schema changes
4. For complex changes, write manual migrations
5. Keep migrations small and focused

## Database Configuration

The database URL is determined in the following order:

1. From the configuration file (config.yaml)
2. From environment variables
3. Default SQLite database (quicktara.db)

## Adding New Models

When adding new models:

1. Define your model in `db/base.py` inheriting from `Base`
2. Import your model in `db/migrations/env.py`
3. Generate a new migration
