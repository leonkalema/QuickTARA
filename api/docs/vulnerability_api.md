# Vulnerability Assessment API Documentation

## Overview

The Vulnerability Assessment API allows for identification, management, and assessment of security vulnerabilities in automotive components. The API supports operations for creating, retrieving, updating, and deleting vulnerabilities, as well as performing automated vulnerability assessment on components.

## Data Models

### Vulnerability

Represents a security vulnerability that could affect automotive components.

**Fields:**
- `vulnerability_id` (string): Unique identifier for the vulnerability
- `name` (string): Name/title of the vulnerability
- `description` (string): Detailed description of the vulnerability
- `severity` (enum): Severity level (Low, Medium, High, Critical)
- `cvss_score` (float): Common Vulnerability Scoring System score (0.0-10.0)
- `cvss_vector` (string): CVSS vector string
- `affected_components` (array): List of component types affected
- `attack_vector` (enum): Attack vector (Network, Adjacent, Local, Physical)
- `attack_complexity` (enum): Attack complexity (Low, High)
- `privileges_required` (enum): Privileges required (None, Low, High)
- `user_interaction` (enum): User interaction required (None, Required)
- `scope` (enum): Scope (Unchanged, Changed)
- `confidentiality_impact` (enum): Confidentiality impact (None, Low, High)
- `integrity_impact` (enum): Integrity impact (None, Low, High)
- `availability_impact` (enum): Availability impact (None, Low, High)
- `exploitability_score` (float): Exploitability subscore
- `impact_score` (float): Impact subscore
- `created_at` (datetime): Creation timestamp
- `updated_at` (datetime): Last update timestamp

### VulnerabilityAssessmentResult

Represents the result of a vulnerability assessment process.

**Fields:**
- `assessment_id` (string): Unique identifier for the assessment
- `component_assessments` (array): Assessment results per component
- `total_components` (integer): Total number of components assessed
- `total_vulnerabilities` (integer): Total number of vulnerabilities found
- `high_severity_vulnerabilities` (integer): Number of high severity vulnerabilities
- `created_at` (datetime): Assessment timestamp
- `scope_id` (string, optional): Associated system scope ID

## API Endpoints

### GET /api/vulnerability

Retrieves a list of vulnerabilities with optional filtering.

**Query Parameters:**
- `component_id` (string, optional): Filter by component ID
- `severity` (string, optional): Filter by severity level
- `skip` (integer, optional, default=0): Number of items to skip
- `limit` (integer, optional, default=100): Maximum number of items to return

**Response:**
```json
{
  "vulnerabilities": [
    {
      "vulnerability_id": "VULN-001",
      "name": "CAN Message Injection",
      "description": "Attacker can inject malicious messages into the CAN bus network",
      "severity": "High",
      "cvss_score": 7.8,
      "affected_components": ["ECU", "Gateway", "Network"],
      ... other fields
    },
    ... more vulnerabilities
  ],
  "total": 10
}
```

### GET /api/vulnerability/{vulnerability_id}

Retrieves a specific vulnerability by ID.

**Path Parameters:**
- `vulnerability_id` (string): ID of the vulnerability to retrieve

**Response:**
```json
{
  "vulnerability_id": "VULN-001",
  "name": "CAN Message Injection",
  "description": "Attacker can inject malicious messages into the CAN bus network",
  "severity": "High",
  "cvss_score": 7.8,
  "affected_components": ["ECU", "Gateway", "Network"],
  ... other fields
}
```

### POST /api/vulnerability

Creates a new vulnerability.

**Request Body:**
```json
{
  "name": "Bluetooth Authentication Bypass",
  "description": "Weak authentication allows unauthorized pairing with vehicle systems",
  "severity": "High",
  "cvss_score": 7.5,
  "affected_components": ["Infotainment", "Telematics"],
  "attack_vector": "Adjacent",
  "attack_complexity": "Low",
  "privileges_required": "None",
  "user_interaction": "None",
  "confidentiality_impact": "High",
  "integrity_impact": "High",
  "availability_impact": "Low"
}
```

**Response:**
The created vulnerability object with generated ID and timestamps.

### PUT /api/vulnerability/{vulnerability_id}

Updates an existing vulnerability.

**Path Parameters:**
- `vulnerability_id` (string): ID of the vulnerability to update

**Request Body:**
```json
{
  "severity": "Critical",
  "cvss_score": 9.2,
  "description": "Updated description with new details"
}
```

**Response:**
The updated vulnerability object.

### DELETE /api/vulnerability/{vulnerability_id}

Deletes a vulnerability.

**Path Parameters:**
- `vulnerability_id` (string): ID of the vulnerability to delete

**Response:**
Empty response with 204 status code on success.

### POST /api/vulnerability/assess

Performs a vulnerability assessment on the specified components.

**Request Body:**
An array of component IDs:
```json
["ECU001", "SENSOR001"]
```

**Response:**
```json
{
  "assessment_id": "VA-7ae226d2-62ed-4635-9825-13f8ae7e12e4",
  "component_assessments": [
    {
      "component_id": "ECU001",
      "component_name": "Engine Control Unit",
      "component_type": "ECU",
      "total_vulnerabilities": 2,
      "high_severity_vulnerabilities": 2,
      "vulnerability_ids": ["VULN-001", "VULN-002"]
    },
    ... more component assessments
  ],
  "total_components": 2,
  "total_vulnerabilities": 3,
  "high_severity_vulnerabilities": 3,
  "created_at": "2025-04-26T12:13:02.132328",
  "scope_id": "scope_2ea2b610"
}
```

## Error Responses

The API may return the following error responses:

- **400 Bad Request**: Invalid request parameters or body
- **404 Not Found**: Resource not found
- **500 Internal Server Error**: Server error

## Testing with Curl

### Get All Vulnerabilities
```
curl -X GET "http://localhost:8080/api/vulnerability" -H "accept: application/json"
```

### Get a Specific Vulnerability
```
curl -X GET "http://localhost:8080/api/vulnerability/VULN-001" -H "accept: application/json"
```

### Create a New Vulnerability
```
curl -X POST "http://localhost:8080/api/vulnerability" -H "Content-Type: application/json" -H "accept: application/json" -d '{
  "name": "Bluetooth Authentication Bypass",
  "description": "Weak authentication allows unauthorized pairing with vehicle systems",
  "severity": "High",
  "cvss_score": 7.5,
  "affected_components": ["Infotainment", "Telematics"],
  "attack_vector": "Adjacent",
  "attack_complexity": "Low",
  "privileges_required": "None",
  "user_interaction": "None",
  "confidentiality_impact": "High",
  "integrity_impact": "High",
  "availability_impact": "Low"
}'
```

### Update a Vulnerability
```
curl -X PUT "http://localhost:8080/api/vulnerability/VULN-001" -H "Content-Type: application/json" -H "accept: application/json" -d '{
  "severity": "Critical",
  "cvss_score": 9.2,
  "description": "Updated description with new details"
}'
```

### Delete a Vulnerability
```
curl -X DELETE "http://localhost:8080/api/vulnerability/VULN-001" -H "accept: application/json"
```

### Perform Vulnerability Assessment
```
curl -X POST "http://localhost:8080/api/vulnerability/assess" -H "Content-Type: application/json" -H "accept: application/json" -d '["BMS001", "BMS002"]'
```
