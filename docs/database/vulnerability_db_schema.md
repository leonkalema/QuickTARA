# Vulnerability Database Schema Documentation

## Overview

The vulnerability database schema provides a comprehensive data model for storing and managing security vulnerabilities in automotive systems. It includes models for vulnerabilities, their mappings to standard vulnerability databases (CWE/CVE), assessment results, and mitigation strategies.

## Entity Relationship Diagram

```
+---------------------+       +------------------------+       +------------------------+
| Vulnerability       |       | VulnerabilityCWEMapping|       | VulnerabilityCVEMapping|
+---------------------+       +------------------------+       +------------------------+
| id                  |<----->| id                     |       | id                     |
| vulnerability_id    |       | vulnerability_id       |       | vulnerability_id       |
| name                |       | cwe_id                 |       | cve_id                 |
| description         |       | cwe_name               |       | cve_description        |
| severity            |       | cwe_description        |       | published_date         |
| cvss_score          |       | relationship_type      |       | last_modified          |
| cvss_vector         |       | created_at             |       | cvss_version           |
| affected_components |       +------------------------+       | created_at             |
| attack_vector       |                                        +------------------------+
| attack_complexity   |                                                  ^
| privileges_required |                                                  |
| user_interaction    |                                                  |
| scope               |                                                  |
| confidentiality_imp |       +------------------------+       +------------------------+
| integrity_impact    |<----->| VulnerabilityAssessment|       | VulnerabilityMitigation|
| availability_impact |       +------------------------+       +------------------------+
| exploitability_score|       | id                     |       | id                     |
| impact_score        |       | assessment_id          |       | mitigation_id          |
| created_at          |       | analysis_id            |       | vulnerability_id       |
| updated_at          |       | component_id           |<----->| title                  |
+---------------------+       | vulnerability_id       |       | description            |
        ^                     | likelihood             |       | mitigation_type        |
        |                     | impact                 |       | effectiveness          |
        |                     | risk_level             |       | implementation_cost    |
        |                     | mitigation_status      |       | implementation_time    |
        |                     | mitigation_notes       |       | prerequisites          |
        |                     | confidence_level       |       | created_at             |
        |                     | detection_method       |       | updated_at             |
        |                     | created_at             |       +------------------------+
        |                     | updated_at             |
        |                     +------------------------+
        |                              ^
        |                              |
        v                              v
+---------------------+       +------------------------+
| Component           |       | Analysis               |
+---------------------+       +------------------------+
| component_id        |<----->| id                     |
| name                |       | name                   |
| type                |       | description            |
| safety_level        |       | created_at             |
| interfaces          |       | updated_at             |
| access_points       |       | total_components       |
| data_types          |       | total_threats          |
| location            |       | critical_components    |
| trust_zone          |       | high_risk_threats      |
| ... other fields    |       +------------------------+
+---------------------+
```

## Table Descriptions

### Vulnerability

Stores information about security vulnerabilities that can affect automotive components.

| Column | Type | Description |
|--------|------|-------------|
| id | Integer | Primary key |
| vulnerability_id | String | Unique identifier (e.g., "VULN-001") |
| name | String | Name of the vulnerability |
| description | Text | Detailed description |
| severity | String | Severity level (Low, Medium, High, Critical) |
| cvss_score | Float | CVSS score (0.0-10.0) |
| cvss_vector | String | CVSS vector string |
| affected_components | JSON | Array of component types affected |
| attack_vector | String | Attack vector (Network, Adjacent, Local, Physical) |
| attack_complexity | String | Attack complexity (Low, High) |
| privileges_required | String | Privileges required (None, Low, High) |
| user_interaction | String | User interaction (None, Required) |
| scope | String | Scope (Unchanged, Changed) |
| confidentiality_impact | String | Confidentiality impact (None, Low, High) |
| integrity_impact | String | Integrity impact (None, Low, High) |
| availability_impact | String | Availability impact (None, Low, High) |
| exploitability_score | Float | Exploitability subscore |
| impact_score | Float | Impact subscore |
| created_at | DateTime | Creation timestamp |
| updated_at | DateTime | Last update timestamp |

### VulnerabilityCWEMapping

Maps vulnerabilities to Common Weakness Enumeration (CWE) entries.

| Column | Type | Description |
|--------|------|-------------|
| id | Integer | Primary key |
| vulnerability_id | String | Foreign key to Vulnerability |
| cwe_id | String | CWE identifier (e.g., "CWE-287") |
| cwe_name | String | CWE name |
| cwe_description | Text | CWE description |
| relationship_type | String | Relationship type (Direct, Parent, Child, Related) |
| created_at | DateTime | Creation timestamp |

### VulnerabilityCVEMapping

Maps vulnerabilities to Common Vulnerabilities and Exposures (CVE) entries.

| Column | Type | Description |
|--------|------|-------------|
| id | Integer | Primary key |
| vulnerability_id | String | Foreign key to Vulnerability |
| cve_id | String | CVE identifier (e.g., "CVE-2022-1234") |
| cve_description | Text | CVE description |
| published_date | DateTime | CVE publication date |
| last_modified | DateTime | CVE last modification date |
| cvss_version | String | CVSS version |
| created_at | DateTime | Creation timestamp |

### VulnerabilityMitigation

Stores mitigation strategies for vulnerabilities.

| Column | Type | Description |
|--------|------|-------------|
| id | Integer | Primary key |
| mitigation_id | String | Unique identifier |
| vulnerability_id | String | Foreign key to Vulnerability |
| title | String | Mitigation title |
| description | Text | Mitigation description |
| mitigation_type | String | Type (Preventive, Detective, Corrective) |
| effectiveness | String | Effectiveness (Low, Medium, High) |
| implementation_cost | String | Implementation cost (Low, Medium, High) |
| implementation_time | String | Implementation time (Short, Medium, Long) |
| prerequisites | JSON | List of prerequisites |
| created_at | DateTime | Creation timestamp |
| updated_at | DateTime | Last update timestamp |

### VulnerabilityAssessment

Stores assessment results for vulnerabilities in specific components.

| Column | Type | Description |
|--------|------|-------------|
| id | Integer | Primary key |
| assessment_id | String | Unique identifier |
| analysis_id | String | Foreign key to Analysis |
| component_id | String | Foreign key to Component |
| vulnerability_id | String | Foreign key to Vulnerability |
| likelihood | Integer | Likelihood score (1-5) |
| impact | JSON | Impact scores (financial, safety, privacy) |
| risk_level | String | Risk level (Low, Medium, High, Critical) |
| mitigation_status | String | Status (Not Started, In Progress, Mitigated) |
| mitigation_notes | Text | Notes on mitigation efforts |
| confidence_level | Float | Confidence level (0.0-1.0) |
| detection_method | String | Method (Manual, Automated, Hybrid) |
| created_at | DateTime | Creation timestamp |
| updated_at | DateTime | Last update timestamp |

## Relationships

1. **Vulnerability to VulnerabilityCWEMapping**: One-to-many. A vulnerability can be mapped to multiple CWE entries.
2. **Vulnerability to VulnerabilityCVEMapping**: One-to-many. A vulnerability can be mapped to multiple CVE entries.
3. **Vulnerability to VulnerabilityMitigation**: One-to-many. A vulnerability can have multiple mitigation strategies.
4. **Vulnerability to VulnerabilityAssessment**: One-to-many. A vulnerability can be assessed in multiple components.
5. **Component to VulnerabilityAssessment**: One-to-many. A component can have multiple vulnerability assessments.
6. **Analysis to VulnerabilityAssessment**: One-to-many. An analysis can include multiple vulnerability assessments.

## Usage Examples

### Finding Vulnerabilities for a Component

```python
# Get all vulnerabilities for a specific component from assessments
component_id = "ECU001"
assessments = db.query(VulnerabilityAssessment).filter(
    VulnerabilityAssessment.component_id == component_id
).all()

vulnerability_ids = [assessment.vulnerability_id for assessment in assessments]
vulnerabilities = db.query(Vulnerability).filter(
    Vulnerability.vulnerability_id.in_(vulnerability_ids)
).all()
```

### Identifying High Severity Vulnerabilities

```python
# Get all high severity vulnerabilities
high_severity_vulns = db.query(Vulnerability).filter(
    Vulnerability.severity.in_(["High", "Critical"])
).all()
```

### Finding Mitigations for a Vulnerability

```python
# Get all mitigations for a specific vulnerability
vulnerability_id = "VULN-001"
mitigations = db.query(VulnerabilityMitigation).filter(
    VulnerabilityMitigation.vulnerability_id == vulnerability_id
).all()
```

## Notes

- The `affected_components` field in the `Vulnerability` table is stored as a JSON array to allow for flexible component type associations.
- The `impact` field in the `VulnerabilityAssessment` table is stored as a JSON object to support multiple impact categories.
- The `prerequisites` field in the `VulnerabilityMitigation` table is stored as a JSON array to maintain a list of prerequisite actions.
- All tables include timestamp fields for auditing purposes.
- Unique string IDs (e.g., "VULN-001") are used as external identifiers for easier reference in reports and user interfaces.
